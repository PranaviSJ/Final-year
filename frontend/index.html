<script src="script.js"></script>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Courtroom</title>
  <link rel="stylesheet" href="style.css">
  <style>
    section { display: none; }
    section.active { display: block; }
  </style>
</head>
<body>

  <!-- Signup Section -->
  <section id="signup" class="active">
    <div class="container">
      <h2>Sign Up</h2>
      <form id="signupForm">
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Sign Up</button>
        <p>Already have an account? <a href="#" id="gotoLogin">Login</a></p>
      </form>
    </div>
  </section>

  <!-- Login Section -->
  <section id="login">
    <div class="container">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Login</button>
        <p>Don't have an account? <a href="#" id="gotoSignup">Sign up</a></p>
      </form>
    </div>
  </section>

  <!-- Role Selection Section -->
  <section id="role">
    <div class="container">
      <h2>Select Your Role</h2>
      <form id="roleForm">
        <button name="role" value="judge" type="submit">I am a Judge</button>
        <button name="role" value="lawyer" type="submit">I am a Lawyer</button>
      </form>
    </div>
  </section>

  <!-- Chat Section -->
  <section id="chat">
    <div class="container chat-container">
      <h2>AI Courtroom Simulation</h2>
      <div class="chat-box" id="chatBox">
        <div class="message user">User: Hello, you are a judge in high court. The case is about criminal. Can we start the roleplay?</div>
        <div class="message assistant">Assistant: Good morning, I am Judge Johnson, and I will be presiding over this case. Please state your name and your position in the case, and then we can proceed with the trial.</div>
      </div>
      <form id="chatForm">
        <input type="text" id="userInput" placeholder="Type your message..." required>
        <button type="submit">Send</button>
      </form>
    </div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const BACKEND_URL = "hhttps://e5deab2c6329.ngrok-free.app/"; // üîπ Update this if ngrok URL changes

      function showSection(id) {
        document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
        document.getElementById(id).classList.add('active');
      }

      document.getElementById('gotoLogin').addEventListener('click', e => {
        e.preventDefault();
        showSection('login');
      });

      document.getElementById('gotoSignup').addEventListener('click', e => {
        e.preventDefault();
        showSection('signup');
      });

      document.getElementById('signupForm').addEventListener('submit', e => {
        e.preventDefault();
        showSection('role');
      });

      document.getElementById('loginForm').addEventListener('submit', e => {
        e.preventDefault();
        showSection('role');
      });

      document.getElementById('roleForm').addEventListener('submit', e => {
        e.preventDefault();
        showSection('chat');
      });

      const form = document.getElementById("chatForm");
      const input = document.getElementById("userInput");
      const chatBox = document.getElementById("chatBox");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const userText = input.value.trim();
        if (!userText) return;

        const userMsg = document.createElement("div");
        userMsg.className = "message user";
        userMsg.innerText = "User: " + userText;
        chatBox.appendChild(userMsg);

        try {
          const res = await fetch(`${BACKEND_URL}/chat`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userText })
          });

          if (!res.ok) throw new Error("Backend error " + res.status);

          const data = await res.json();

          const assistantMsg = document.createElement("div");
          assistantMsg.className = "message assistant";
          assistantMsg.innerText = "Assistant: " + data.response;
          chatBox.appendChild(assistantMsg);

        } catch (error) {
          console.error("Error talking to backend:", error);
          const errorMsg = document.createElement("div");
          errorMsg.className = "message error";
          errorMsg.innerText = "‚ö†Ô∏è Could not connect to the backend.";
          chatBox.appendChild(errorMsg);
        }

        input.value = "";
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    });
  </script>
</body>
</html>
